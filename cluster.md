# DBSCAN 分群主題設計

本文件定義使用 DBSCAN 進行帳戶交易行為分群的主題方案。

---

## 📊 核心特徵（13 個）

- **交易規模**（3）：`txn_cnt`, `active_days`, `txn_cnt_per_day`
- **金額特徵**（3）：`mean_amt`, `std_amt`, `p95_amt`
- **行為比例**（4）：`self_txn_ratio`, `cross_bank_ratio`, `night_txn_ratio`, `foreign_currency_ratio`
- **時間行為**（3）：`min_txn_gap`, `std_txn_gap`, `max_txn_per_day`

---

## 主題 1：交易活躍度分群

### 使用特徵（4個）
- `txn_cnt` - 帳戶總交易筆數
- `active_days` - 有交易發生的不同天數
- `txn_cnt_per_day` - 平均每日交易筆數
- `max_txn_per_day` - 單日最大交易筆數

### 為什麼分這個主題

**業務意義**：
區分正常活躍用戶 vs 異常爆發式交易

**風控價值**：
- 短時間大量交易（高 `max_txn_per_day` + 低 `active_days`）是洗錢/詐騙的典型特徵
- `max_txn_per_day` 是目前唯一有明顯區分度的特徵（警示帳戶 2.8 vs 正常帳戶 1.4，差異 2.0x）

**預期發現**：
- **爆發型交易群組**：警示帳戶可能集中在此
- **休眠戶群組**：低風險
- **正常活躍用戶群組**：持續穩定使用

---

## 主題 2：資金規模與波動分群

### 使用特徵（3個）
- `mean_amt` - 平均交易金額
- `std_amt` - 交易金額標準差
- `p95_amt` - 交易金額第 95 百分位數

### 為什麼分這個主題

**業務意義**：
識別大額異常與金額不穩定帳戶

**風控價值**：
- 高 `std_amt` / `mean_amt` 比值 → 金額劇烈波動 → 資金快進快出（洗錢特徵）
- 極高 `p95_amt` → 極端大額交易 → 需審查資金來源合法性

**預期發現**：
- **金額波動異常群組**：可能是洗錢帳戶
- **極端大額交易群組**：需要額外審查
- **正常小額/中額穩定群組**：低風險客群

---

## 主題 3：異常行為指標分群

### 使用特徵（4個）
- `self_txn_ratio` - 自轉帳比例
- `cross_bank_ratio` - 跨行交易比例
- `night_txn_ratio` - 夜間交易比例（22:00-06:00）
- `foreign_currency_ratio` - 外幣交易比例

### 為什麼分這個主題

**業務意義**：
直接對應風控領域的異常行為指標

**風控價值**：
- 高 `self_txn_ratio` → 分層洗錢（資金在自己帳戶間反覆移動）
- 高 `night_txn_ratio` → 機器人帳號或異常作息
- 高 `foreign_currency_ratio` → 非典型行為，可能涉及資金外流

**預期發現**：
- **自轉帳異常群組**：高風險
- **夜間活躍群組**：可能是機器人或輪班工作者
- **外幣交易群組**：國際貿易或資金流動
- **正常行為群組**：低風險

**限制**：
- 目前這些特徵的區分度都 < 2x
- 但如果 DBSCAN 能找到多個特徵組合的異常模式，仍有價值

---

## 主題 4：交易節奏與自動化分群

### 使用特徵（3個）
- `min_txn_gap` - 最短交易時間間隔（秒）
- `std_txn_gap` - 交易間隔標準差
- `max_txn_per_day` - 單日最大交易筆數

### 為什麼分這個主題

**業務意義**：
識別自動化程式、機器人帳號

**風控價值**：
- 極短 `min_txn_gap`（< 60秒）+ 低 `std_txn_gap` → 高度規律的自動化程式
- 結合高 `max_txn_per_day` → 機器人帳號特徵

**預期發現**：
- **機器人可疑群組**：快速連續交易、節奏一致
- **正常人工操作群組**：間隔不規則
- **規律型用戶群組**：定期定額交易（薪轉、貸款）

**注意事項**：
- 需要排除單筆交易帳戶（57% 的帳戶，gap 為 0）
- 或為單筆帳戶單獨處理

---

## 🎯 主題優先順序建議

### **推薦執行順序**

#### 1. 優先做「主題 1：交易活躍度」
**原因**：
- ✅ 有最強的區分特徵（`max_txn_per_day`）
- ✅ 業務意義明確（爆發式交易）
- ✅ 資料處理簡單（不需排除單筆帳戶）

#### 2. 次做「主題 3：異常行為」
**原因**：
- ✅ 最符合風控邏輯
- ✅ 4 個特徵尺度一致（都是 0-1 比例）
- ⚠️ 雖然單一特徵區分度低，但可能組合有效

#### 3. 再做「主題 4：交易節奏」
**原因**：
- ✅ 可以抓機器人行為
- ⚠️ 需要先處理單筆帳戶問題

#### 4. 選做「主題 2：資金規模」
**原因**：
- 金額維度的風險評估
- 可與其他主題交叉驗證

---

## 📝 DBSCAN 分群後的評估方法

### **評估指標**

1. **群組純度**
   ```
   每個群的警示帳戶比例
   目標：至少有一個群 > 1%（是整體平均 0.094% 的 10 倍以上）
   ```

2. **覆蓋率**
   ```
   各群組包含多少警示帳戶
   目標：高風險群組能涵蓋 20% 以上的警示帳戶
   ```

3. **預測帳戶分布**
   ```
   4,541 個預測帳戶落在哪些群
   高風險群中有多少預測帳戶
   ```

### **交叉驗證策略**

做完多個主題後，可以交叉分析：

```
例如：
預測帳戶 X：
  - 主題1：爆發型（警示率 5%）
  - 主題3：自轉帳異常（警示率 3%）
  - 主題4：機器人可疑（警示率 8%）

綜合判斷：多個高風險信號 → 高風險預測
```

---

## ⚠️ 重要提醒

### **DBSCAN 的特性**

1. **不需要預設群數**
   - 演算法自動找群組
   - 不像 K-Means 需要指定 K

2. **會產生 Noise（離群點）**
   - 不屬於任何群的點
   - 這些點可能就是最異常的帳戶

3. **參數敏感**
   - `eps`（鄰域半徑）：決定多相似算一群
   - `min_samples`：決定多少點才算一群
   - 需要多次實驗調整

### **資料前處理**

1. **必須標準化**
   - 特徵尺度差異大（txn_cnt 最大 1462 vs ratio 最大 1）
   - 使用 StandardScaler

2. **考慮排除極端值**
   - 或使用 Winsorization 壓縮極端值

3. **單筆交易帳戶**
   - 主題 1, 2, 3：可以保留
   - 主題 4：建議排除（gap 為 0）

---

**文件版本**：v2.0  
**更新日期**：2026-01-03  
**用途**：DBSCAN 分群指南
